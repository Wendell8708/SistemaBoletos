{% extends "base.html" %}
{% block content %}
<h2>Boletos</h2>

<form id="formBoleto" class="mb-4">
    <input type="number" id="fornecedor_id" placeholder="ID do Fornecedor" required class="form-control mb-2">
    <input type="number" step="0.01" id="valor" placeholder="Valor" required class="form-control mb-2">
    <input type="date" id="vencimento" required class="form-control mb-2">
    <select id="situacao" class="form-select mb-2">
        <option value="pendente">Pendente</option>
        <option value="Pago">Pago</option>
        <option value="Vencido">Vencido</option>
    </select>
    <button type="submit" class="btn btn-primary">Adicionar</button>
</form>

<table class="table table-striped" id="tabelaBoletos">
    <thead>
        <tr>
            <th>ID</th>
            <th>Fornecedor</th>
            <th>Valor</th>
            <th>Vencimento</th>
            <th>Situação</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const formB = document.getElementById('formBoleto');
const tabelaB = document.querySelector('#tabelaBoletos tbody');

function listarBoletos(){
    fetch('/boletos/')
    .then(res => res.json())
    .then(data => {
        tabelaB.innerHTML = '';
        data.forEach(b => {
            tabelaB.innerHTML += `<tr>
                <td>${b.id}</td>
                <td>${b.fornecedor}</td>
                <td>${b.valor}</td>
                <td>${b.vencimento}</td>
                <td>${b.situação}</td>
            </tr>`;
        });
    });
}

formB.addEventListener('submit', e => {
    e.preventDefault();
    const boleto = {
        fornecedor_id: document.getElementById('fornecedor_id').value,
        valor: document.getElementById('valor').value,
        vencimento: document.getElementById('vencimento').value,
        situação: document.getElementById('situacao').value
    };
    fetch('/boletos/', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(boleto)
    }).then(() => {
        formB.reset();
        listarBoletos();
    });
});

listarBoletos();
</script>
{% endblock %}
